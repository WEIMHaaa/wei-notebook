# 一、Redis为什么需要持久化
由于Redis的数据都存放在内存中，如果没有配置持久化，Redis重启后数据就全丢失了，于是需要开启Redis的持久化功能，将数据保存到磁盘上，当Redis重启后，可以从磁盘中恢复数据。  


# 二、Redis提供两种方式进行持久化
## 1、RDB（Redis DataBase）持久化
原理是将Reids在内存中的数据库记录定时dump到磁盘上的RDB持久化。  
RDB方式生成dump.rdb文件。dump.rdb是由Redis服务器自动生成的。默认情况下 每隔一段时间Redis服务器程序会自动对数据库做一次遍历，把内存快照写在一个叫做“dump.rdb”的文件里，这个持久化机制叫做SNAPSHOT。有了SNAPSHOT后，如果服务器宕机，重新启动Redis服务器程序时Redis会自动加载dump.rdb，将数据库状态恢复到上一次做SNAPSHOT时的状态。至于多久做一次SNAPSHOT，SNAPSHOT文件的路径和文件名，你可以在Redis的conf文件里指定。  

## 2、AOF（Append Only File）持久化
原理是将Reids的操作日志以追加的方式写入文件。
以日志的形式来记录每个写操作，将Redis执行过的所有写指令记录下来(读操作不记录)，只许追加文件但不可以改写文件，redis启动之初会读取该文件重新构建数据，换言之，Redis重启的话就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作  


# 三、RDB和AOF二者的区别
## 1、RDB持久化
RDB持久化是指在指定的时间间隔内将内存中的数据集快照写入磁盘，实际操作过程是fork一个子进程，先将数据集写入临时文件，写入成功后，再替换之前的文件，用二进制压缩存储。  

### 优势
适合大规模的数据恢复；  
对数据完整性和一致性要求不高。  

### 劣势
在一定间隔时间做一次备份，所以如果redis意外down掉的话，就会丢失最后一次快照后的所有修改；
fork的时候，内存中的数据被克隆了一份，大致2倍的膨胀性需要考虑。  

## 2、AOF持久化
AOF持久化以日志的形式记录服务器所处理的每一个写、删除操作，查询操作不会记录，以文本的方式记录，可以打开文件看到详细的操作记录。  

### 优势
appendfsync always   同步持久化 每次发生数据变更会被立即记录到磁盘  性能较差但数据完整性比较好；  
appendfsync everysec    异步操作，每秒记录，如果一秒内宕机，有数据丢失；  
appendfsync no   从不同步。

### 劣势
相同数据集的数据而言aof文件要远大于rdb文件，恢复速度慢于rdb；  
aof运行效率要慢于rdb,每秒同步策略效率较好，不同步效率和rdb相同。